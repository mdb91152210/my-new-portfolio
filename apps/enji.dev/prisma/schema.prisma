generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

// =========================
// Content Metadata
// =========================
model ContentMeta {
  id        String     @id @map("_id") @db.ObjectId @default(auto())
  type      ContentType
  title     String
  slug      String     @unique
  views     View[]
  shares    Share[]
  reactions Reaction[]
  createdAt DateTime   @default(now())

  @@index([createdAt])
}

// =========================
// View Model
// =========================
model View {
  id        String      @id @map("_id") @db.ObjectId @default(auto())
  createdAt DateTime    @default(now())
  sessionId String

  contentId String      @db.ObjectId
  content   ContentMeta @relation(fields: [contentId], references: [id], onDelete: Cascade)
}

// =========================
// Share Model
// =========================
model Share {
  id        String      @id @map("_id") @db.ObjectId @default(auto())
  type      ShareType?  @default(OTHERS)
  createdAt DateTime    @default(now())
  sessionId String

  contentId String      @db.ObjectId
  content   ContentMeta @relation(fields: [contentId], references: [id], onDelete: Cascade)
}

// =========================
// Reaction Model
// =========================
model Reaction {
  id        String       @id @map("_id") @db.ObjectId @default(auto())
  count     Int          @default(1)
  section   String?
  type      ReactionType @default(CLAPPING)
  createdAt DateTime     @default(now())
  sessionId String

  contentId String      @db.ObjectId
  content   ContentMeta @relation(fields: [contentId], references: [id], onDelete: Cascade)
}

// =========================
// Enums
// =========================
enum ContentType {
  PAGE
  POST
  PROJECT
}

enum ShareType {
  LINKEDIN
  CLIPBOARD
  OTHERS
}

enum ReactionType {
  CLAPPING
  THINKING
  AMAZED
}
